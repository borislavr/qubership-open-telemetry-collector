# Installation Notes

## Deployment Configuration

See below the full list of parameters which defines the Open Telemetry Collector deployment mode and is used during the
installation. Mandatory parameters from the list must be specified for Open Telemetry Collector in helm.

<!-- markdownlint-disable line-length -->
| Parameter                                     | Mandatory | Default                                                                                    | Value Example               | Description                                                                                                                                                                                                                                                                                                |
| --------------------------------------------- | --------- | ------------------------------------------------------------------------------------------ | --------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `OTEC_INSTALLATION_MODE`                      | N         | SPAN_METRICS_PROCESSOR                                                                     | `SPAN_METRICS_PROCESSOR`    | The type of OOB configuration (SPAN_METRICS_PROCESSOR or SENTRY_ENVELOPES_PROCESSING)                                                                                                                                                                                                                      |
| `SERVICE_NAME`                                | N         | open-telemetry-collector                                                                   | `open-telemetry-collector`  | The Kubernetes service name for Open Telemetry Collector.                                                                                                                                                                                                                                                  |
| `MONITORING_ENABLED`                          | N         | false                                                                                      | `false`                     | Disables and enables the service monitor.                                                                                                                                                                                                                                                                  |
| `resources`                                   | N         | requests: cpu: 100m  memory: 100Mi  limits: cpu: 200m memory: 200Mi                        |                             | Set up this object to use custom profiles configuration.                                                                                                                                                                                                                                                   |
| `PAAS_PLATFORM`                               | N         | KUBERNETES                                                                                 | 'KUBERNETES' or 'OPENSHIFT' | The name of type cloud environment                                                                                                                                                                                                                                                                         |
| `imagePullSecrets`                            | N         | -                                                                                          |                             | K8s imagePullSecrets for private registry access.                                                                                                                                                                                                                                                          |
| `labels`                                      | N         | -                                                                                          |                             | The Kubernetes labels setup.                                                                                                                                                                                                                                                                               |
| `entrypoint`                                  | N         | /otelcol-contrib                                                                           | /otelcol-contrib            | The path to the opentelemetry binary.                                                                                                                                                                                                                                                                      |
| `JAEGER_COLLECTOR_HOST`                       | N         | -                                                                                          | jaeger-app-collector.jaeger | The Jaeger hostname or IP.                                                                                                                                                                                                                                                                                 |
| `JAEGER_COLLECTOR_OTLP_PORT`                  | N         | 4317                                                                                       | 4317                        | The port for the Jaeger service OpenTelemetry Protocol span reporting API.                                                                                                                                                                                                                                 |
| `TRACING_HOST`                                | N         | -                                                                                          | jaeger-app-collector.jaeger | Jaeger URL. It is used if JAEGER_COLLECTOR_HOST is not set.                                                                                                                                                                                                                                                |
| `GRAYLOG_COLLECTOR_HOST`                      | N         | `https://graylog-logging.${CLOUD_PUBLIC_HOST}`                                             |                             | The Graylog hostname or IP to which OTeC sends data from traces                                                                                                                                                                                                                                            |
| `GRAYLOG_COLLECTOR_PORT`                      | N         | 12201                                                                                      | 12201                       | The port for the Graylog service.                                                                                                                                                                                                                                                                          |
| `GRAYLOG_UI_URL`                              | N         | `https://graylog-logging.${CLOUD_PUBLIC_HOST}]`                                            |                             | The Graylog hostname or IP. It is used if GRAYLOG_COLLECTOR_HOST is not set.                                                                                                                                                                                                                               |
| `CONFIG_MAP`                                  | N         | -                                                                                          |                             | Config map customization.                                                                                                                                                                                                                                                                                  |
| `SERVICE_PORTS`                               | N         | -                                                                                          |                             | Customization for service.ports.                                                                                                                                                                                                                                                                           |
| `SERVICE_MONITOR_PORT_NAME`                   | N         | exporter-prom                                                                              | exporter-prom               | Customization for ServiceMonitor port.                                                                                                                                                                                                                                                                     |
| `LATENCY_HISTOGRAM_BUCKETS`                   | N         | [2ms, 4ms, 6ms, 8ms, 10ms, 50ms, 100ms, 200ms, 400ms, 800ms, 1s, 1400ms, 2s, 5s, 10s, 15s] | [100ms, 1s, 10s]            | The list of durations defining the latency histogram buckets. If it is not set, the default list is used.                                                                                                                                                                                                  |
| `CLOUD_TOPOLOGIES`                            | N         | -                                                                                          |                             | Array of topology settings for topologySpreadConstraints. Each array element must contain at least 'topologyKey' attribute. Other supported attributes are 'maxSkew' and 'whenUnsatisfiable', which are optional. This parameter has higher priority over CLOUD_TOPOLOGY_KEY. Should not be an empty list. |
| `CLOUD_TOPOLOGY_KEY`                          | N         | kubernetes.io/hostname                                                                     |                             | Defines topologyKey in topologySpreadConstraints. This is a BWC parameter.                                                                                                                                                                                                                                 |
| `DEPLOYMENT_STRATEGY_TYPE`                    | N         |                                                                                            |                             | The Kubernetes rolling update deployment strategy. Possible values are "recreate", "best_effort_controlled_rollout", "ramped_slow_rollout", and "custom_rollout".                                                                                                                                          |
| `DEPLOYMENT_STRATEGY_MAXSURGE`                | N         | 25%                                                                                        | 25%                         | The parameter sets maxSurge if DEPLOYMENT_STRATEGY_TYPE is "custom_rollout".                                                                                                                                                                                                                               |
| `DEPLOYMENT_STRATEGY_MAXUNAVAILABLE`          | N         | 25%                                                                                        | 25%                         | The parameter sets maxUnavailable if DEPLOYMENT_STRATEGY_TYPE is "custom_rollout".                                                                                                                                                                                                                         |
| `LOG_LEVEL`                                   | N         | info                                                                                       | info                        | The parameter indicates the OTeC log level. The possible values are "debug", "info", "warn", and "error".                                                                                                                                                                                                  |
| `OTEC_LOG_FORMAT`                             | N         | json                                                                                       | text                        | The parameter allows to specify log format. It might be convenient to use text format for dev purposes. Json is strongly recommended on prod.                                                                                                                                                              |
| `OTEC_SENTRY_ENVELOPES_INGRESS_ENABLED`       | N         | false                                                                                      | true                        | The parameter allows to enable the default sentry ingress.                                                                                                                                                                                                                                                 |
| `OTEC_SENTRY_ENVELOPES_INGRESS_ANNOTATIONS`   | N         |                                                                                            | string map in YAML format   | The parameter allows to specify the annotations map for the sentry ingress.                                                                                                                                                                                                                                |
| `OTEC_SENTRY_RECEIVER_PARAMETERS`             | N         |                                                                                            | Object                      | The parameter allows to customize sentry receiver parameters.                                                                                                                                                                                                                                              |
| `OTEC_SENTRY_EVENT_METRICS_PARAMETERS`        | N         |                                                                                            | Object                      | The parameter allows to customize setry event metrics parameters.                                                                                                                                                                                                                                          |
| `OTEC_SENTRY_MEASUREMENTS_METRICS_PARAMETERS` | N         |                                                                                            | Object                      | The parameter allows to customize setry measurements metrics parameters.                                                                                                                                                                                                                                   |
| `OTEC_LOGTCPEXPORTER_PARAMETERS`              | N         |                                                                                            | Object                      | The parameter allows to customize logtcpexporter parameters.                                                                                                                                                                                                                                               |
| `OTEC_HEALTH_CHECK_PORT`                      | N         | 13133                                                                                      | 13133                       | The parameter allows to customize OTeC health check port wich is used for liveness and readiness probes                                                                                                                                                                                                    |
| `OTEC_ENABLE_ARBITRARY_TRACES_LOGGING`        | N         | false                                                                                      | false                       | The parameter allows to enable arbitrary traces logging.                                                                                                                                                                                                                                                   |
| `OTEC_ARBITRARY_TRACES_LOGGING_CONFIG`        | N         |                                                                                            | Object                      | The parameter allows to customize arbitrary traces logging configuration.                                                                                                                                                                                                                                  |
<!-- markdownlint-enable line-length -->

**Note:** Open Telemetry Collector preprocesses traces before they come to the Jaeger storage. For proper work, a trace
generating application must be configured to send the traces not to Jaeger directly, but to the Open Telemetry Collector
endpoint. Open Telemetry Collector receives the traces, generates the metrics on their basis, then re-sends the traces to
Jaeger. The generated Prometheus metrics are later available for pulling via the service monitor.

Jaeger endpoint configuration is the essential part of the OTeC configuration in helm. Note, that if the parameter
JAEGER_COLLECTOR_HOST is not empty, the traces are sent to JAEGER_COLLECTOR_HOST:JAEGER_COLLECTOR_PORT URL.

If the helm parameter JAEGER_COLLECTOR_HOST is empty, URL is taken from the helm parameter TRACING_HOST. If the helm parameters
TRACING_HOST and JAEGER_COLLECTOR_HOST are both empty, then the traces are sent to the default URL
jaeger-app-collector.jaeger:JAEGER_COLLECTOR_PORT. The default value for JAEGER_COLLECTOR_PORT is 14250.
